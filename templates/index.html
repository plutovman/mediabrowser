{% extends "base.html" %}

{% block title %}Media Gallery{% endblock %}

{% block extra_styles %}
.random-image {
    width: 250px;
    height: auto;
    display: block;
    margin: 20px auto;
}

.modal-content {
    width: 50%;
    height: auto;
}
{% endblock %}

{% block content %}

    {% if random_image %}
    <div style="text-align: center;">
        <div class="media-card" style="display: inline-block;">
            {% if random_image['ext_is_viewable'] %}
            <img src="{{ url_for('static', filename=random_image['thumbnail_relative_path']) }}" 
                 alt="{{ random_image['file_name'] }}"
                 class="random-image thumbnail"
                 data-open-image="{{ url_for('static', filename=random_image['thumbnail_relative_path']) }}">
            {% if random_image['file_type'] == 'mp4' %}
            <button type="button" class="play-button"
                    data-open-video="{{ url_for('static', filename=random_image['relative_path']) }}"
                    data-poster="{{ url_for('static', filename=random_image['thumbnail_relative_path']) }}">â–¶</button>
            {% endif %}
            {% else %}
            <img src="{{ url_for('static', filename=random_image['thumbnail_relative_path']) }}" 
                 alt="{{ random_image['file_name'] }}"
                 class="random-image thumbnail"
                 style="cursor: pointer;"
                 data-download-file="{{ url_for('static', filename=random_image['relative_path']) }}"
                 data-download-name="{{ random_image['file_name'] }}">
            {% endif %}
        </div>
        <p>{{ random_image['file_name'] }}</p>
    </div>
    {% endif %}

    <!-- Search Form -->
    <form class="search-form" method="GET" action="{{ url_for('search') }}">
        <input type="text" name="query" placeholder="Search genre, category, subject, tags..." value="{{ random_image['subject'] if random_image else '' }}">
        <select name="file_type">
            <option value="">All File Types</option>
            <option value="mp4">mp4</option>
            <option value="jpg">jpg</option>
            <option value="psd">psd</option>
            <option value="prproj">prproj</option>
            <option value="docx">docx</option>
            <option value="xlsx">xlsx</option>
            <option value="pptx">pptx</option>
            <option value="hip">hip</option>
            <option value="nk">nk</option>
            <option value="obj">obj</option>
            <option value="other0">other0</option>
            <option value="other1">other1</option>
            <option value="other2">other2</option>
            <option value="other3">other3</option>
            <option value="other4">other4</option>
        </select>
        <select name="genre">
            <option value="">All Genres</option>
            <option value="action">action</option>
            <option value="adventure">adventure</option>
            <option value="comedy">comedy</option>
            <option value="drama">drama</option>
            <option value="fantasy">fantasy</option>
            <option value="horror">horror</option>
            <option value="mystery">mystery</option>
            <option value="romance">romance</option>
            <option value="sci-fi">sci-fi</option>
            <option value="thriller">thriller</option>
        </select>
        <button type="submit">Search</button>
    </form>

    <!-- Word Cloud -->
    <div style="text-align: center; margin: 40px auto; max-width: 900px;">
        <h3 style="color: #ffffff; margin-bottom: 20px;">Popular Subjects</h3>
        <div style="line-height: 2.5; margin-bottom: 30px;">
            {% for subject, count in top_subjects.items() %}
                {% set font_size = 12 + (count * 0.15)|int %}
                <a href="{{ url_for('search', query=subject) }} style="font-size: {{ font_size }}px; margin: 5px 10px; color: #7fbfff; text-decoration: none; display: inline-block;">{{ subject }}</a>
            {% endfor %}
        </div>
        <h3 style="color: #ffffff; margin-bottom: 20px;">Popular Genres</h3>
        <div style="line-height: 2.5;">
            {% for genre, count in top_genres.items() %}
                {% set font_size = 12 + (count * 0.15)|int %}
                <a href="{{ url_for('search', genre=genre) }} style="font-size: {{ font_size }}px; margin: 5px 10px; color: #7fbfff; text-decoration: none; display: inline-block;">{{ genre }}</a>
            {% endfor %}
        </div>
    </div>
{% endblock %}
