{% extends "base.html" %}

{% block title %}Media Gallery{% endblock %}

{% block extra_styles %}
.random-image {
    width: 250px;
    height: auto;
    display: block;
    margin: 20px auto;
}

.modal-content {
    width: 50%;
    height: auto;
}
{% endblock %}

{% block content %}

    {% if random_image %}
    <div style="text-align: center;">
        <div class="media-card" style="display: inline-block;">
            {% if random_image['ext_is_viewable'] %}
            <img src="{{ url_for('static', filename=random_image['thumbnail_relative_path']) }}" 
                 alt="{{ random_image['file_name'] }}"
                 class="random-image thumbnail"
                 data-open-image="{{ url_for('static', filename=random_image['thumbnail_relative_path']) }}">
            {% if random_image['file_type'] == 'mp4' %}
            <button type="button" class="play-button"
                    data-open-video="{{ url_for('static', filename=random_image['relative_path']) }}"
                    data-poster="{{ url_for('static', filename=random_image['thumbnail_relative_path']) }}">â–¶</button>
            {% endif %}
            {% else %}
            <img src="{{ url_for('static', filename=random_image['thumbnail_relative_path']) }}" 
                 alt="{{ random_image['file_name'] }}"
                 class="random-image thumbnail"
                 style="cursor: pointer;"
                 data-download-file="{{ url_for('static', filename=random_image['relative_path']) }}"
                 data-download-name="{{ random_image['file_name'] }}">
            {% endif %}
        </div>
        <p>{{ random_image['file_name'] }}</p>
    </div>
    {% endif %}

    <!-- Search Form -->
    <form class="search-form" method="GET" action="{{ url_for('page_search') }}">
        <input type="text" name="query" placeholder="Search genre, category, subject, tags..." value="{{ random_image['subject'] if random_image else '' }}">
        <select name="db_table" onchange="window.location.href='{{ url_for('page_index') }}?db_table=' + this.value;">
            {% for table in db_tables %}
            <option value="{{ table }}" {% if db_table == table %}selected{% endif %}>{{ table }}</option>
            {% endfor %}
        </select>
        <select name="file_type">
            <option value="">All File Types</option>
            {% for ft in file_types %}
            <option value="{{ ft }}">{{ ft }}</option>
            {% endfor %}
        </select>
        <select name="genre">
            <option value="">All Genres</option>
            {% for g in genres %}
            <option value="{{ g }}">{{ g }}</option>
            {% endfor %}
        </select>
        <button type="submit">Search</button>
    </form>

    <!-- Append DB Button -->
    <div style="text-align: center; margin: 15px 0;">
        <a href="{{ url_for('page_archive', db_table=db_table) }}">
            <button type="button">Append DB ({{ db_table }})</button>
        </a>
    </div>

    <!-- Word Cloud -->
    <div style="text-align: center; margin: 40px auto; max-width: 900px;">
        <h3 style="color: #ffffff; margin-bottom: 20px;">Top {{ top_topics }} Subjects</h3>
        <div style="line-height: 2.5; margin-bottom: 30px;">
            {% for subject, count in top_subjects.items() %}
                {% set font_size = 12 + (count * 0.15)|int %}
                {% set link_style = "font-size: " ~ font_size ~ "px; margin: 5px 10px; color: #7fbfff; text-decoration: none; display: inline-block;" %}
                <a href="{{ url_for('page_search', query=subject, db_table=db_table) }}" style="{{ link_style }}">{{ subject }}</a>
            {% endfor %}
        </div>
        <h3 style="color: #ffffff; margin-bottom: 20px;">Top {{ top_topics }} Genres</h3>
        <div style="line-height: 2.5;">
            {% for genre, count in top_genres.items() %}
                {% set font_size = 12 + (count * 0.15)|int %}
                {% set link_style = "font-size: " ~ font_size ~ "px; margin: 5px 10px; color: #7fbfff; text-decoration: none; display: inline-block;" %}
                <a href="{{ url_for('page_search', genre=genre, db_table=db_table) }}" style="{{ link_style }}">{{ genre }}</a>
            {% endfor %}
        </div>
    </div>
{% endblock %}
